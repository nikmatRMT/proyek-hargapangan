<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Diagram Sistem Informasi - HARPA BANUA</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00d4ff, #7c3aed, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
        }

        .diagram-container {
            background: #ffffff;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow-x: auto;
        }

        .diagram-title {
            text-align: center;
            color: #1a1a2e;
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .legend-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .legend-card h3 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-card h3 .icon {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .legend-card ul {
            list-style: none;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }

        .legend-card ul li {
            padding: 4px 0;
            padding-left: 20px;
            position: relative;
        }

        .legend-card ul li::before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: #7c3aed;
        }

        .entity {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .service {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .utility {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .info-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-section h2 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #00d4ff;
        }

        .info-section p {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.7;
            font-size: 0.95rem;
        }

        .relationship-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }

        .relationship-table th,
        .relationship-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .relationship-table th {
            background: rgba(255, 255, 255, 0.1);
            color: #00d4ff;
            font-weight: 600;
        }

        .relationship-table td {
            color: rgba(255, 255, 255, 0.8);
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-assoc {
            background: #3b82f6;
            color: white;
        }

        .badge-comp {
            background: #10b981;
            color: white;
        }

        .badge-dep {
            background: #f59e0b;
            color: white;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .diagram-container {
                padding: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üìä Class Diagram Sistem Informasi</h1>
            <p>HARPA BANUA - Sistem Informasi Harga Pangan Indonesia</p>
        </div>

        <!-- Main Class Diagram -->
        <div class="diagram-container">
            <h2 class="diagram-title">Gambar 3.6 Class Diagram Sistem HARPA BANUA</h2>
            <div class="mermaid">
                classDiagram
                direction TB

                %% ==================== ENTITY CLASSES ====================
                class User {
                +int id
                +string nip
                +string nama_lengkap
                +string username
                +string password
                +string role
                +int is_active
                +string phone
                +string alamat
                +string foto
                +Date created_at
                +Date updated_at
                --
                +login()
                +logout()
                +updateProfile()
                +uploadAvatar()
                +changePassword()
                +resetPassword()
                }

                class Pasar {
                +int id
                +string nama_pasar
                +string alamat
                +Date created_at
                +Date updated_at
                --
                +create()
                +update()
                +delete()
                +getAll()
                +findById()
                }

                class Komoditas {
                +int id
                +string nama_komoditas
                +string unit
                +Date created_at
                +Date updated_at
                --
                +create()
                +update()
                +delete()
                +getAll()
                +findById()
                }

                class LaporanHarga {
                +int id
                +string tanggal_lapor
                +int market_id
                +int komoditas_id
                +int user_id
                +int harga
                +string keterangan
                +string foto_url
                +string gps_url
                +Date created_at
                +Date updated_at
                --
                +create()
                +update()
                +delete()
                +getByDateRange()
                +getByMarket()
                +getByKomoditas()
                +bulkDelete()
                +validatePrice()
                }

                %% ==================== SERVICE CLASSES ====================
                class AuthService {
                <<service>>
                    +string sessionSecret
                    +int sessionMaxAge
                    --
                    +login(username, password)
                    +logout(sessionId)
                    +validateSession(req)
                    +hashPassword(plain)
                    +comparePassword(plain, hash)
                    +requireAuth()
                    +requireRole(role)
                    }

                    class ExportService {
                    <<service>>
                        +Date startDate
                        +Date endDate
                        +int filterMarket
                        +int filterKomoditas
                        --
                        +generateExcel(options)
                        +generatePDF(options)
                        +generatePDFKomoditas(options)
                        +generatePDFBackupAll(options)
                        +buildWorkbook(data)
                        +buildRowsForExport()
                        }

                        class ImportService {
                        <<service>>
                            +int maxFileSize
                            +string[] allowedTypes
                            --
                            +importExcel(file)
                            +importFlex(file)
                            +validateExcelFormat(wb)
                            +parseExcelData(sheet)
                            +processBulkInsert(rows)
                            +createMissingCommodities(names)
                            }

                            class StatisticsService {
                            <<service>>
                                --
                                +getDashboardStats()
                                +getPricesByMarket()
                                +getPricesByKomoditas()
                                +getMonthlyTrends()
                                +getDailyAverage()
                                +getActivityHeatmap()
                                }

                                %% ==================== UTILITY CLASSES ====================
                                class Session {
                                <<utility>>
                                    +string sid
                                    +Object user
                                    +Date expires
                                    --
                                    +save()
                                    +destroy()
                                    +regenerate()
                                    }

                                    class AuditLog {
                                    <<utility>>
                                        +string collectionName
                                        +int documentId
                                        +string action
                                        +Object user
                                        +Object before
                                        +Object after
                                        +Date timestamp
                                        --
                                        +log(action, data)
                                        }

                                        class BlobStorage {
                                        <<utility>>
                                            +string baseUrl
                                            --
                                            +uploadToBlob(buffer, filename)
                                            +deleteFromBlob(url)
                                            +getPublicUrl(key)
                                            }

                                            %% ==================== RELATIONSHIPS ====================

                                            %% Entity Relationships
                                            LaporanHarga "many" --> "1" Pasar : belongs to
                                            LaporanHarga "many" --> "1" Komoditas : belongs to
                                            LaporanHarga "many" --> "1" User : created by

                                            %% Service Dependencies
                                            User ..> AuthService : uses
                                            User ..> BlobStorage : uploads avatar
                                            LaporanHarga ..> ExportService : exports
                                            LaporanHarga ..> ImportService : imports
                                            LaporanHarga ..> StatisticsService : analyzes

                                            %% Utility Dependencies
                                            AuthService ..> Session : manages
                                            User ..> AuditLog : logs changes
                                            Pasar ..> AuditLog : logs changes
                                            Komoditas ..> AuditLog : logs changes
                                            LaporanHarga ..> AuditLog : logs changes
                                            LaporanHarga ..> BlobStorage : stores photos
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-card">
                <h3><span class="icon entity">üì¶</span> Entity Classes</h3>
                <ul>
                    <li><strong>User</strong> - Pengguna sistem (Admin/Petugas)</li>
                    <li><strong>Pasar</strong> - Data pasar tradisional</li>
                    <li><strong>Komoditas</strong> - Data jenis komoditas pangan</li>
                    <li><strong>LaporanHarga</strong> - Laporan harga harian</li>
                </ul>
            </div>

            <div class="legend-card">
                <h3><span class="icon service">‚öôÔ∏è</span> Service Classes</h3>
                <ul>
                    <li><strong>AuthService</strong> - Autentikasi & otorisasi</li>
                    <li><strong>ExportService</strong> - Export PDF/Excel</li>
                    <li><strong>ImportService</strong> - Import data Excel</li>
                    <li><strong>StatisticsService</strong> - Statistik dashboard</li>
                </ul>
            </div>

            <div class="legend-card">
                <h3><span class="icon utility">üîß</span> Utility Classes</h3>
                <ul>
                    <li><strong>Session</strong> - Manajemen session login</li>
                    <li><strong>AuditLog</strong> - Log perubahan data</li>
                    <li><strong>BlobStorage</strong> - Penyimpanan file (Vercel Blob)</li>
                </ul>
            </div>
        </div>

        <!-- Relationship Info -->
        <div class="info-section">
            <h2>üìå Keterangan Relasi</h2>
            <table class="relationship-table">
                <thead>
                    <tr>
                        <th>Dari</th>
                        <th>Ke</th>
                        <th>Kardinalitas</th>
                        <th>Tipe</th>
                        <th>Keterangan</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>LaporanHarga</td>
                        <td>Pasar</td>
                        <td>Many to 1</td>
                        <td><span class="badge badge-assoc">Association</span></td>
                        <td>Setiap laporan harga mengacu ke satu pasar</td>
                    </tr>
                    <tr>
                        <td>LaporanHarga</td>
                        <td>Komoditas</td>
                        <td>Many to 1</td>
                        <td><span class="badge badge-assoc">Association</span></td>
                        <td>Setiap laporan harga mengacu ke satu komoditas</td>
                    </tr>
                    <tr>
                        <td>LaporanHarga</td>
                        <td>User</td>
                        <td>Many to 1</td>
                        <td><span class="badge badge-assoc">Association</span></td>
                        <td>Setiap laporan dibuat oleh satu petugas/admin</td>
                    </tr>
                    <tr>
                        <td>User</td>
                        <td>AuthService</td>
                        <td>-</td>
                        <td><span class="badge badge-dep">Dependency</span></td>
                        <td>User menggunakan AuthService untuk login/logout</td>
                    </tr>
                    <tr>
                        <td>LaporanHarga</td>
                        <td>ExportService</td>
                        <td>-</td>
                        <td><span class="badge badge-dep">Dependency</span></td>
                        <td>Laporan dapat di-export ke Excel/PDF</td>
                    </tr>
                    <tr>
                        <td>LaporanHarga</td>
                        <td>ImportService</td>
                        <td>-</td>
                        <td><span class="badge badge-dep">Dependency</span></td>
                        <td>Laporan dapat di-import dari file Excel</td>
                    </tr>
                    <tr>
                        <td>All Entities</td>
                        <td>AuditLog</td>
                        <td>-</td>
                        <td><span class="badge badge-dep">Dependency</span></td>
                        <td>Semua perubahan data dicatat ke audit log</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Attribute Info -->
        <div class="info-section">
            <h2>üìã Penjelasan Atribut Utama</h2>
            <p style="margin-bottom: 15px;">
                Berikut adalah penjelasan atribut-atribut penting pada class diagram:
            </p>
            <table class="relationship-table">
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Atribut</th>
                        <th>Tipe</th>
                        <th>Keterangan</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="4">User</td>
                        <td>nip</td>
                        <td>string (18 digit)</td>
                        <td>Nomor Induk Pegawai, wajib unik</td>
                    </tr>
                    <tr>
                        <td>role</td>
                        <td>enum</td>
                        <td>admin | petugas | super_admin</td>
                    </tr>
                    <tr>
                        <td>is_active</td>
                        <td>int</td>
                        <td>Status aktif (1) atau nonaktif (0)</td>
                    </tr>
                    <tr>
                        <td>foto</td>
                        <td>string (URL)</td>
                        <td>URL foto profil di Vercel Blob</td>
                    </tr>
                    <tr>
                        <td rowspan="2">LaporanHarga</td>
                        <td>tanggal_lapor</td>
                        <td>string (YYYY-MM-DD)</td>
                        <td>Tanggal laporan harga</td>
                    </tr>
                    <tr>
                        <td>harga</td>
                        <td>int</td>
                        <td>Harga dalam Rupiah</td>
                    </tr>
                    <tr>
                        <td>Komoditas</td>
                        <td>unit</td>
                        <td>string</td>
                        <td>Satuan harga: (Rp/Kg) atau (Rp/Liter)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="footer">
            <p><strong>Gambar 3.6</strong> Class Diagram Sistem Informasi Harga Pangan HARPA BANUA</p>
            <p style="margin-top: 10px;">¬© 2024 - Sistem Informasi Harga Pangan Indonesia</p>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#3b82f6',
                primaryTextColor: '#1f2937',
                primaryBorderColor: '#2563eb',
                lineColor: '#6b7280',
                secondaryColor: '#10b981',
                tertiaryColor: '#f3f4f6',
                fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif',
                fontSize: '14px',
                classText: '#1f2937'
            },
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
    </script>
</body>

</html>