<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Diagram - HARPA BANUA</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 30px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-title {
            text-align: center;
            color: #fff;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .page-subtitle {
            text-align: center;
            color: #aaa;
            font-size: 14px;
            margin-bottom: 25px;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
            font-size: 13px;
        }

        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .legend-entity {
            background: #3498db;
        }

        .legend-service {
            background: #27ae60;
        }

        .legend-utility {
            background: #e67e22;
        }

        .diagram-wrapper {
            background: #ffffff;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            overflow-x: auto;
        }

        .mermaid {
            display: flex;
            justify-content: center;
        }

        .caption {
            text-align: center;
            margin-top: 25px;
            color: #ccc;
            font-size: 14px;
        }

        /* ========== MERMAID CUSTOM STYLES ========== */

        /* Entity Classes - Blue */
        .mermaid .entity>rect {
            fill: #e3f2fd !important;
            stroke: #1976d2 !important;
            stroke-width: 2px !important;
        }

        .mermaid .entity .classTitle {
            fill: #0d47a1 !important;
            font-weight: bold !important;
        }

        /* Service Classes - Green */
        .mermaid .service>rect {
            fill: #e8f5e9 !important;
            stroke: #388e3c !important;
            stroke-width: 2px !important;
        }

        .mermaid .service .classTitle {
            fill: #1b5e20 !important;
            font-weight: bold !important;
        }

        /* Utility Classes - Orange */
        .mermaid .utility>rect {
            fill: #fff3e0 !important;
            stroke: #f57c00 !important;
            stroke-width: 2px !important;
        }

        .mermaid .utility .classTitle {
            fill: #e65100 !important;
            font-weight: bold !important;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="page-title">Class Diagram Sistem Informasi Harga Pangan</h1>
        <p class="page-subtitle">HARPA BANUA - Sistem Monitoring Harga Pangan Indonesia</p>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-box legend-entity"></div>
                <span>Entity Class</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-service"></div>
                <span>Service Class</span>
            </div>
            <div class="legend-item">
                <div class="legend-box legend-utility"></div>
                <span>Utility Class</span>
            </div>
        </div>

        <div class="diagram-wrapper">
            <pre class="mermaid">
classDiagram
    direction TB

    %% ==================== ENTITY CLASSES ====================
    class User {
        +int id
        +string nip
        +string nama_lengkap
        +string username
        +string password
        +string role
        +int is_active
        +string phone
        +string alamat
        +string foto
        +Date created_at
        +Date updated_at
        +login()
        +logout()
        +updateProfile()
        +uploadAvatar()
        +changePassword()
        +resetPassword()
    }

    class Pasar {
        +int id
        +string nama_pasar
        +string alamat
        +Date created_at
        +Date updated_at
        +create()
        +update()
        +delete()
        +getAll()
        +findById()
    }

    class Komoditas {
        +int id
        +string nama_komoditas
        +string unit
        +Date created_at
        +Date updated_at
        +create()
        +update()
        +delete()
        +getAll()
        +findById()
    }

    class LaporanHarga {
        +int id
        +string tanggal_lapor
        +int market_id
        +int komoditas_id
        +int user_id
        +int harga
        +string keterangan
        +string foto_url
        +string gps_url
        +Date created_at
        +Date updated_at
        +create()
        +update()
        +delete()
        +getByDateRange()
        +getByMarket()
        +getByKomoditas()
        +bulkDelete()
        +validatePrice()
    }

    %% ==================== SERVICE CLASSES ====================
    class AuthService {
        &lt;&lt;service&gt;&gt;
        +string sessionSecret
        +int sessionMaxAge
        +login(username, password)
        +logout(sessionId)
        +validateSession(req)
        +hashPassword(plain)
        +comparePassword(plain, hash)
        +requireAuth()
        +requireRole(role)
    }

    class ExportService {
        &lt;&lt;service&gt;&gt;
        +Date startDate
        +Date endDate
        +int filterMarket
        +int filterKomoditas
        +generateExcel(options)
        +generatePDF(options)
        +generatePDFKomoditas(options)
        +generatePDFBackupAll(options)
        +buildWorkbook(data)
        +buildRowsForExport()
    }

    class ImportService {
        &lt;&lt;service&gt;&gt;
        +int maxFileSize
        +string[] allowedTypes
        +importExcel(file)
        +importFlex(file)
        +validateExcelFormat(wb)
        +parseExcelData(sheet)
        +processBulkInsert(rows)
        +createMissingCommodities(names)
    }

    class StatisticsService {
        &lt;&lt;service&gt;&gt;
        +getDashboardStats()
        +getPricesByMarket()
        +getPricesByKomoditas()
        +getMonthlyTrends()
        +getDailyAverage()
        +getActivityHeatmap()
    }

    %% ==================== UTILITY CLASSES ====================
    class Session {
        &lt;&lt;utility&gt;&gt;
        +string sid
        +Object user
        +Date expires
        +save()
        +destroy()
        +regenerate()
    }

    class AuditLog {
        &lt;&lt;utility&gt;&gt;
        +string collectionName
        +int documentId
        +string action
        +Object user
        +Object before
        +Object after
        +Date timestamp
        +log(action, data)
    }

    class BlobStorage {
        &lt;&lt;utility&gt;&gt;
        +string baseUrl
        +uploadToBlob(buffer, filename)
        +deleteFromBlob(url)
        +getPublicUrl(key)
    }

    %% ==================== RELATIONSHIPS ====================
    
    LaporanHarga "many" --> "1" User : created by
    LaporanHarga "many" --> "1" Pasar : belongs to
    LaporanHarga "many" --> "1" Komoditas : belongs to
    
    User ..> AuthService : uses
    User ..> BlobStorage : uploads avatar
    
    LaporanHarga ..> ExportService : exports
    LaporanHarga ..> ImportService : imports
    LaporanHarga ..> StatisticsService : analyzes
    LaporanHarga ..> BlobStorage : stores photos
    
    AuthService ..> Session : manages
    
    User ..> AuditLog : logs changes
    Pasar ..> AuditLog : logs changes
    Komoditas ..> AuditLog : logs changes
    LaporanHarga ..> AuditLog : logs changes

    %% ==================== STYLING ====================
    
    class User:::entity
    class Pasar:::entity
    class Komoditas:::entity
    class LaporanHarga:::entity
    
    class AuthService:::service
    class ExportService:::service
    class ImportService:::service
    class StatisticsService:::service
    
    class Session:::utility
    class AuditLog:::utility
    class BlobStorage:::utility
            </pre>
        </div>

        <p class="caption"><b>Gambar 3.6</b> Class Diagram Sistem Informasi Harga Pangan HARPA BANUA</p>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                // Entity classes - Blue
                classText: '#333',

                // Default styling
                primaryColor: '#e3f2fd',
                primaryBorderColor: '#1976d2',
                primaryTextColor: '#0d47a1',

                // Line colors
                lineColor: '#555',

                // Font
                fontFamily: 'Segoe UI, Arial, sans-serif',
                fontSize: '12px'
            },
            classDiagram: {
                useMaxWidth: true,
                padding: 20
            },
            themeCSS: `
                .entity > rect { fill: #e3f2fd !important; stroke: #1976d2 !important; stroke-width: 2px !important; }
                .entity .classTitle { fill: #0d47a1 !important; font-weight: bold !important; }
                
                .service > rect { fill: #e8f5e9 !important; stroke: #388e3c !important; stroke-width: 2px !important; }
                .service .classTitle { fill: #1b5e20 !important; font-weight: bold !important; }
                
                .utility > rect { fill: #fff3e0 !important; stroke: #f57c00 !important; stroke-width: 2px !important; }
                .utility .classTitle { fill: #e65100 !important; font-weight: bold !important; }
            `
        });
    </script>
</body>

</html>